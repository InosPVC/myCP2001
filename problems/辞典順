https://atcoder.jp/contests/abc202/tasks/abc202_d

#include <bits/stdc++.h>
using namespace std;
#define rep(i,a) for(int i=0;i<(a);i++)
int res[200005];
vector<int> child[200005];
vector<int> Qd[200005];
vector<int> Qi[200005];
vector<int> Din[200005];
int depth_count[200005] = {};
void dfs(int p, int depth) {
    int Qn = Qd[p].size();
    Din[p].resize(Qn);
    rep(i, Qn) {
        Din[p][i] = depth_count[Qd[p][i]];
    }
    depth_count[depth]++;
    for(auto c : child[p]) {
        dfs(c, depth + 1);
    }
    rep(i, Qn) {
        int r = depth_count[Qd[p][i]] - Din[p][i];
        res[Qi[p][i]] = r;
    }
}
int main(){
    int n;
    scanf("%d", &n);
    rep(i, n-1) {
        int p;
        scanf("%d", &p);
        child[p-1].push_back(i+1);
    }
    int q;
    scanf("%d", &q);
    rep(i, q) {
        int u, d;
        scanf("%d%d", &u, &d);
        Qd[u-1].push_back(d);
        Qi[u-1].push_back(i);
    }
    dfs(0, 0);
    rep(i, q) {
        printf("%d\n", res[i]);
    }
    return 0;
}
